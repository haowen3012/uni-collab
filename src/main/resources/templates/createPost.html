<!DOCTYPE html>
<html lang="en"  xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>Uni-Collab</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" th:href="@{/createPost.css}" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.js"></script>
</head>
<body>
<div id="container-nav" >
  <div class="navbar">
    <div>
      <i  id="message" class="fa fa-bell" aria-hidden="true"></i>
      <i style="border-radius:50px" class="fa-solid fa-circle"></i>
    </div>
    <div>
      <i id="home" class="fa fa-home"></i>
      <i style="border-radius:50px" class="fa-solid fa-circle"></i>
    </div>
    <div class="profile-section">
      <i id="profile" class="fa">&#xf2be;</i>
      <i style="border-radius:50px" class="fa-solid fa-circle"></i>

      <span id="drop-down">
          <a class="content">profile</a>
          <a class="content">your posts</a>
          <a class="content"> Log out</a>
        </span>

    </div>
  </div>
  <div class="padding">
    <div></div>
    <div class="search">
      <i class="fa fa-search" aria-hidden="true"></i>
      <input></input>

    </div>
    <div></div>
  </div>
</div>
<div id="container">
  <div class="flex-item-1" >
    <input placeholder="Create a post"/>
  </div>
</div>
<div th:each="post : ${posts}">
  <div id="post" >
    <div class="owner" th:if="${post.owner.userName}">
      <h1 th:text="${post.owner.userName}">OWNER</h1>
      <div style="color:#4169e1"> 3 hours ago</div>
    </div>
    <div th:unless="${post.owner.userName}"class="owner" >
      <h1 th:text="${post.owner.firstName}">OWNER</h1>
      <div style="color:#4169e1"> 3 hours ago</div>
    </div>
    <div class="project">
      <h1 class="section-title">PROJECT</h1>
      <div class="project-name" th:text="${post.projectName}"> PROJECT NAME</div>
    </div>
    <div class="project-description">
      <h1 class="section-title">DESCRIPTION</h1>
      <div class="description" th:text="${post.projectDescription}">
        Il progetto di mobile computing consiste nella creazione di un gioco mobile con autenticazione. Mi servono 3 colleghi di progetto.
      </div>
    </div>
    <div class="bottom">
      <div class="bottom-left">

        <div class="places-left">
          <i class="fa fa-circle" style="color: lawngreen" ></i>
          <div> PLACES AVAILABLE </div>
          <span  th:text="${post.membership - post.acceptedUsers.size()}">3</span>
        </div>

        <div class="deadline">
          <div>APPLICATION DEADLINE </div>
          <span class="time" th:text="${#temporals.format( post.deadline, 'dd/MM/yyyy HH:mm')}">30/12/2023 19:12</span>
        </div>

      </div>
      <div><button class="publish">apply</button></div>
    </div>
  </div>
</div>
<!-----pop up---->

<form id="container-2"
      th:action="@{/createPost}"  method="post" >
  <h1 >YOUR NAME</h1>
  <div class="section-1">
    <div class="section-title">PROJECT NAME</div>
    <input class="flex-item" placeholder="Enter your project name" type="text"  name="projectName"/>
  </div>
  <div class="section-2">
    <div class="section-title">PROJECT DESCRIPTION</div>
    <textarea class="flex-item-2" role="textbox" contenteditable type="text"  name="projectDescription">Enter the project description for your project</textarea>
  </div>
  <div class="section-3">
    <div  class="section-title">MEMBERSHIP</div>
    <input type="number" class="special-input" min="1" max="7" placeholder="Enter the number of memebers"
           name="membership"/>
  </div>
  <div class="section-3">
    <div  class="section-title">DEADLINE</div>
    <input  class="special-input" type="datetime-local"  name="deadline"/>
  </div>
  <div class="section-4">
    <button class="publish"  type="button" id="go-back" >go back</button>
    <button class="publish" type ="submit">publish</button>
  </div>
</form>
<!------------->
<!---<div id="messages"> </div>--  NOTIFICHE CON WEBSOCKET-->
<script>

  var container_1 =  document.getElementById('container');
  var post_form = document.getElementById('container-2');
  var go_back = document.getElementById('go-back');

  var post = document.getElementById('post');

  container_1.addEventListener('click',()=>{

    post_form.style.display= "flex";
    post_form.style.animation ="slide-in-down 1.1s ease-out forwards";


  });



  go_back.addEventListener('click',()=>{

    post_form.style.animation ="slide-out-anim 1s ease-out forwards";

    post.style.animation = "none";


    setTimeout( function(){
      post_form.style.display = "none";},1000);


  });

</script>

<script>
  var stompClient = null;
  var privateStompClient = null;

  var socket = new SockJS('/ws');
  stompClient = Stomp.over(socket);
  stompClient.connect({}, function(frame) {
    console.log(frame);
    stompClient.subscribe('/all/messages', function(result) {
      console.log(result.body);
      show(JSON.parse(result.body));
    });
  });

  socket = new SockJS('/ws');
  privateStompClient = Stomp.over(socket);
  privateStompClient.connect({}, function (frame) {
    console.log(frame);
    privateStompClient.subscribe('/user/specific', function (result) {
      console.log(result.body);
      show(JSON.parse(result.body));
    });
  });


  function sendMessage(){
    var text = document.getElementById('text').value;

    stompClient.send('/app/application', {}, JSON.stringify({ text: text }));
  }

  function sendPrivateMessage(){
    var text = document.getElementById('privateText').value;
    var destination = document.getElementById('destination').value;
    stompClient.send("/app/private",{}, JSON.stringify({ text: text, destination: destination}));
  }

  function show(message){
    var response = document.getElementById('messages');
    var p = document.createElement('p');

    p.innerHTML ="message:" + message.text;
    response.appendChild(p);
  }
</script>

</body>

</html>